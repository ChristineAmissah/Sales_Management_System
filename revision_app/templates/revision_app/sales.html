{% extends 'revision_app/main.html' %}
{% load static %}

{% block content %}
<body style="background-image: url('{% static 'img/pexels-tirachard-kumtanom-112571-733856.jpg' %}'); background-size: cover; background-position: center; min-height: 100vh;">

<div class="container-fluid my-0 position-relative mx-0 px-0" style="padding-top: 56px; z-index: 1;">
<div class="container-fluid mx-0 px-0 w-100">
<div class="row">
<div class="col-11"></div>

<div class="d-flex mb-6 justify-content-end text-align-center position-fixed" style="z-index: 1050; width: 91.78%; background-color: rgba(39, 41, 35, 0.5);">
  
    <h3 class="text-align-center text-white py-1" style="margin-right: 15vh;">Sales</h3>

    <div class="input-group my-0 py-0" style="width: 15%; height: inherit; margin-right: 15px;">
        <span class="input-group-text">Start Date:</span>
        <input type="date" id="start_date" class="form-control">
      </div>


    <div class="input-group" style="width: 15%; height: inherit; margin-right: 10px;">
        <span class="input-group-text">End Date:</span>
        <input type="date" id="end_date" class="form-control">
     </div>
     <span class="d-flex align-items-center"><a href="{% url 'generate_pdf' %}" class="btn btn-success" onclick="generatePDF()">Generate Sales Report</a></span>

</div></div>
<div class="container-fluid" style="padding-top: 55px;">
<table class="table table-bordered my-3 w-100 text-center fs-5 table-dark table-striped ">
    <thead>
        <tr class="table-light">
            <th>Number</th>
            <th>Unique Key</th>
            <th>Product</th>
            <th>Quantity Sold</th>
            <th>&#8373;Total Price</th>
            <th>Date Sold</th>
            <th>Salesperson</th>
        </tr>
    </thead>
    <tbody>
        {% for sale in sales %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ sale.unique_key }}</td>
            <td>{{ sale.product }}</td>
            <td>{{ sale.quantity_sold }}</td>
            <td>{{ sale.total_price|floatformat:2 }}</td>
            <td>{{ sale.date_sold }}</td>
            <td>{{ sale.salesperson.username|capfirst }}
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">No sales available.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination Controls -->
<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
</div>
</div>
</div>
</div>
<script>
function generatePDF() {
    // Get the start and end dates from the input fields
    const startDate = document.getElementById('start_date').value;
    const endDate = document.getElementById('end_date').value;

    // Check if both dates are provided
    if (startDate && endDate) {
        // Redirect to the generate_pdf URL with the date parameters
        window.location.href = `/generate-pdf?start_date=${startDate}&end_date=${endDate}`;
    } else {
        alert("Please select both start and end dates.");
    }
}
</script>
{% endblock %}